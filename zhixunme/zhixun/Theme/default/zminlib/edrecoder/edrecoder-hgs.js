(function(a){a.extend({CreatCardTemp:function(d){var i={};var h=a.extend(i,d);if(a("#"+h.id).length==0){var e='<div class="cards_cover" id="'+h.id+'"><div class="cardsbody"></div></div>';a("body").append(e);var b='<div class="bc_item"><div class="top"><p class="lf"></p><p class="rf"></p></div><div class="middle"><div class="mbg">';var c='<div class="msghead"><span>目前阶段:</span><span class="nowstage"><select id="cateNow"><option value="1">潜在客户</option><option value="2">正在合作</option><option value="3">失效客户</option><option value="4">其他</option></select><select id="proNow" class="prog"><option value="1">已沟通</option><option value="2">已报价</option><option value="3">已做方案</option><option value="4">已签合同</option><option value="5">已成交</option><option value="6">谈判中</option><option value="7">已发合同</option><option value="8">售后完善</option><option value="9">后期维护</option><option value="10">其他</option></select></span></td></div>';var g='<table><tbody><tr><td class="ltop"><span>交易记录:</span></td><td rowspan="5"><textarea id="editext" name="recoder"></textarea></td></tr></tbody></table><a class="card_close"></a><div class="al_bt"><span class="red lf"></span><div class="msgbutton"><div class="btn_common btn3"><span class="b_lf"></span><span class="b_rf"></span><a href="javascript:;" class="btn blue card_sub" datacont="" id="sendmsgtozx">确&nbsp;&nbsp;定</a></div></div></div></div></div><div class="bot"><p class="lf"></p><p class="rf"></p>';var f=a("#"+h.id);b+=c+g;f.find("div.cardsbody").append(b);a.RenderCardData(h);f.fadeIn();a.BindCardSub(h);baseController.BtnBind("#editCard div.btn_common","btn3","btn3_hov","btn3_click")}},RenderCardData:function(g){var f=a("#proNow");var d=a("#cateNow");var e=g.tosever.cate_id;var c=g.tosever.pro_id;var b=a("#editext");b.val(g.tosever.notes);f.addClass("hidden");a("#proNow option").eq(c-1).attr("selected","true");if(g.tosever.cate_id==2){f.removeClass("hidden")}d.change(function(){if(a(this).val()==2){f.removeClass("hidden")}else{f.addClass("hidden")}});a("#cateNow option").eq(e-1).attr("selected","true");a("#cateNow").attr("disabled","disabled");a("#proNow").attr("disabled","disabled");if(g.me.hasClass("ad_rd")){a("#cateNow").removeAttr("disabled");a("#proNow").removeAttr("disabled");b.val("")}else{b.val(a.trim(g.tosever.notes))}},BindCardSub:function(e){var c=a("#"+e.id);var f=a("#proNow"),d=a("#cateNow");var b;if(e.me.hasClass("ad_rd")){a("#editext").focus()}c.find("a.card_close").unbind("click").bind("click",function(){c.fadeOut(200,function(){e.me.removeClass("c");a("#editCard").remove()})});c.find("a.card_sub").unbind("click").bind("click",function(){if(d.val()!=2){b=0}else{b=f.val()}var g=a(this).CheckCardInput();if(g){var h={cate_id:d.val(),pro_id:b,notes:a("#editext").val()};a.extend(e.tosever,h);a(this).hEditRecodeCards(e)}})}});a.extend(a.fn,{GetManageData:function(c){var b=this;a(b).unbind("click").bind("click",function(){var d=c(a(this));var e=a(this);a(this).addClass("c");a.CreatCardTemp(d)})},hEditRecodeCards:function(e){var f="";var b="";a.each(e.tosever,function(g,h){b+="&"+g+"="+h});b=b.substr(1);b=b.replace("&url="+e.tosever.url,"");var c=this;var d={url:e.tosever.url,params:b,sucrender:e.sc,failrender:c.SendRecoderFail};HGS.Base.HAjax(d)},SendRecoderSuc:function(){var b=a("#msgnote");b.html("成功修改数据!");a("#editCard").fadeOut(200,function(){b.html("");a("#hr_list td.last a.ad_rd.c").removeClass("c");a(this).remove()})},SendRecoderFail:function(b){alert("对不起,暂时不能编辑数据!")},CheckCardInput:function(){var c=null;var d=a(this).parent().parent().prev();var b=a.trim(a("#editext").val());if(!b){d.html("交易记录不能为空!");c=0}else{c=1}return c}})})(jQuery);